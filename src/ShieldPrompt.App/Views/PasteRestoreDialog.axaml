<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:ShieldPrompt.App.ViewModels"
        x:Class="ShieldPrompt.App.Views.PasteRestoreDialog"
        x:DataType="vm:PasteRestoreViewModel"
        Title="ðŸ“¥ Paste AI Response"
        Width="900" Height="600"
        WindowStartupLocation="CenterOwner">

    <Grid RowDefinitions="Auto,*,Auto,*,Auto" Margin="15">
        
        <!-- Title -->
        <TextBlock Grid.Row="0" 
                   Text="Paste the AI response to restore original values"
                   FontSize="14"
                   Margin="0,0,0,15"/>

        <!-- Paste Area -->
        <Border Grid.Row="1"
                BorderBrush="{DynamicResource SystemControlHighlightBaseLowBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="10">
            <Grid RowDefinitions="Auto,*,Auto">
                <TextBlock Grid.Row="0" 
                           Text="AI Response (paste here):"
                           FontWeight="Bold"
                           Margin="0,0,0,5"/>
                
                <TextBox Grid.Row="1"
                         Text="{Binding PastedContent}"
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         FontFamily="Consolas,Menlo,monospace"
                         MinHeight="150"/>

                <Button Grid.Row="2"
                        Content="ðŸ“‹ Paste from Clipboard"
                        Command="{Binding PasteFromClipboardCommand}"
                        HorizontalAlignment="Right"
                        Margin="0,10,0,0"/>
            </Grid>
        </Border>

        <!-- Detected Aliases with Enhanced Preview -->
        <Border Grid.Row="2" 
                Margin="0,15,0,0"
                BorderBrush="{DynamicResource SystemControlHighlightBaseLowBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Background="{DynamicResource SystemControlBackgroundAltMediumLowBrush}"
                Padding="12">
            <StackPanel>
                <TextBlock Text="{Binding PreviewSummary}"
                           FontWeight="Bold"
                           FontSize="14"
                           Margin="0,0,0,10"/>
                
                <ScrollViewer MaxHeight="120">
                    <ItemsControl ItemsSource="{Binding DetectedAliases}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                                        CornerRadius="4"
                                        Padding="10,6"
                                        Margin="0,3">
                                    <Grid ColumnDefinitions="Auto,*,Auto,*,Auto">
                                        <TextBlock Grid.Column="0" 
                                                   Text="ðŸ”“"
                                                   FontSize="14"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>
                                        <TextBlock Grid.Column="1" 
                                                   Text="{Binding Alias}"
                                                   FontFamily="Consolas,Menlo,monospace"
                                                   Foreground="Gray"
                                                   VerticalAlignment="Center"/>
                                        <TextBlock Grid.Column="2" 
                                                   Text=" â†’ "
                                                   Margin="10,0"
                                                   VerticalAlignment="Center"/>
                                        <TextBlock Grid.Column="3" 
                                                   Text="{Binding Original}"
                                                   FontFamily="Consolas,Menlo,monospace"
                                                   FontWeight="Bold"
                                                   Foreground="Green"
                                                   VerticalAlignment="Center"/>
                                        <TextBlock Grid.Column="4" 
                                                   Text="{Binding Occurrences, StringFormat='({0}x)'}"
                                                   FontSize="11"
                                                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                                   Margin="8,0,0,0"
                                                   VerticalAlignment="Center"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </StackPanel>
        </Border>

        <!-- Restored Preview -->
        <Border Grid.Row="3"
                BorderBrush="{DynamicResource SystemControlHighlightBaseLowBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="10"
                Margin="0,15,0,0">
            <Grid RowDefinitions="Auto,*">
                <TextBlock Grid.Row="0" 
                           Text="Preview (with values restored):"
                           FontWeight="Bold"
                           Margin="0,0,0,5"/>
                
                <ScrollViewer Grid.Row="1">
                    <TextBox Text="{Binding RestoredContent}"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             FontFamily="Consolas,Menlo,monospace"
                             IsReadOnly="True"
                             Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                             MinHeight="150"/>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Buttons -->
        <StackPanel Grid.Row="4" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Spacing="10"
                    Margin="0,15,0,0">
            <Button Content="Cancel" 
                    Click="OnCancelClick"
                    Padding="20,8"/>
            <Button Content="ðŸ“‹ Copy Restored to Clipboard" 
                    Command="{Binding CopyRestoredCommand}"
                    Padding="20,8"/>
        </StackPanel>

    </Grid>

</Window>

